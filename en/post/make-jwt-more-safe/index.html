<!doctype html><html lang=en dir=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>Make JWT more safe - Uncle Tony</title><meta name=keywords content="Blog,Software,Product,Architecture,defi,solidity,rust,golang,blockchain"><meta name=author content="guotie"><meta property="og:title" content="Make JWT more safe"><meta property="og:site_name" content="Uncle Tony"><meta property="og:image" content="/img/author.jpg"><meta name=title content="Make JWT more safe - Uncle Tony"><meta name=description content="JWT is very popular today. How to make JWT more safer? we proposal 3 methods."><link rel="shortcut icon" href=https://www.tiege.dev/img/favicon.ico><link rel=apple-touch-icon href=https://www.tiege.dev/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://www.tiege.dev/img/apple-touch-icon.png><link href=//cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.css rel=stylesheet><link href=https://www.tiege.dev/css/main.css rel=stylesheet type=text/css><link href=https://www.tiege.dev/css/syntax.css rel=stylesheet type=text/css><script type=text/javascript>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?cbd45c2023eacf671acbf5faf4b5343d",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-103849967-1"></script>
<script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-103849967-1 ")</script></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-Hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class="site-meta custom-logo"><div class=multi-lang-switch><i class="fa fa-fw fa-language" style=margin-right:5px></i>
<a class=lang-link id=zh-cn href=https://www.tiege.dev/post/make-jwt-more-safe/>中文</a>
<span class=lang-line>/</span>
<a class=lang-link id=en href=#>English</a></div><div class=custom-logo-site-title><a href=https://www.tiege.dev/en/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>Uncle Tony</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>A journey of a thousand miles begins with a single step</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=https://www.tiege.dev/en/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class=menu-item><a href=https://www.tiege.dev/en/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archive</a></li><li class=menu-item><a href=https://www.tiege.dev/en/about/index.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class=menu-item><a href=https://www.tiege.dev/en/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>Page404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder="Enter key words..." spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://www.tiege.dev/en/post/make-jwt-more-safe/ itemprop=url>Make JWT more safe</a></h1><div class=post-meta><span class=post-time><i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>Published at:</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2023/10/21">2023/10/21</time></span>
<span class=post-category>&nbsp; | &nbsp;
<i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>Categories:</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a href=https://www.tiege.dev/en/categories/jwt itemprop=url rel=index style=text-decoration:underline><span itemprop=name>JWT</span></a>
&nbsp;</span></span>
<span>|
<i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>Words:</span>
<span class=leancloud-world-count>419 words</span></span>
<span>|
<i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>Reading:</span>
<span class=leancloud-view-count>2 minutes</span></span>
<span id=/en/post/make-jwt-more-safe/ class=leancloud_visitors data-flag-title="Make JWT more safe">|
<i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>Visited:</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><h1 id=what-is-jwt>What is JWT</h1><p>JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA.</p><h1 id=make-jwt-more-safe>Make JWT more safe</h1><h2 id=secret-for-every-account>secret for every Account</h2><p>In some best practice of JWT, they just say we need an universe secret for every account signature, which mostly from an envirment varible. But the secret is so fundemental, is it enough safe that a global secret for all account? Nobody care it, nobody discuss it, nobody mention it.</p><p>We use different salt to hash account password for different account, why we use same secret for all account? The JWT is JUST as important as user&rsquo;s password!</p><p>In my opinion, we should use different secret for every account, just like password salt.</p><p>If we use different secret for every account, we should save the secret in server side, DB or redis. Of course, this will slow down the JWT validate flow, but we could save the secret in server&rsquo;s memory cache after server start up.</p><h2 id=save--validate-signature-in-server-side>save & validate signature in server side</h2><p>JWT is mostly about how to verify the JWT token is valid, by the signature. In most scene, this is great. But in some case, for example, we want kick off a special user, JWT can do nothing.</p><p>So, we could save the JWT signature in the server, then we could verify the JWT twice:</p><ul><li>first, verify the signature;</li><li>second, check the signature in server DB or redis, if exists, the JWT is valid; or else invalid</li></ul><p>By this method, we can kick off user or force user re-login.</p><p>Also, there are some tricks, we don&rsquo;t need to save all JWT payload in the server, for example, we can just save the userId and JWT signature in the server side.</p><h2 id=jwt-for-anonymous-or-visitors>JWT for anonymous or visitors</h2><p>Sometime we want give better user expirence for the anonymous or visitors, we can use JWT to record visitor&rsquo;s information. For example, the user&rsquo;s information:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>    name
</span></span><span style=display:flex><span>    IP address
</span></span><span style=display:flex><span>    first visit time
</span></span><span style=display:flex><span>    location(optional)
</span></span></code></pre></div><p>use these information, we could track visitors and provide good expirence.</p><h1 id=question>Question</h1><p>If we use JWT this way, why we use JWT instead of session? One of the most benefit of JWT is the client can get many information from JWT, even they have not connect to the server.</p></div><footer class=post-footer><div class=post-tags><a href=https://www.tiege.dev/en/tags/jwt rel=tag title=JWT>#JWT#</a>
<a href=https://www.tiege.dev/en/tags/safety rel=tag title=safety>#safety#</a></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>Declaration：</span>Make JWT more safe</p><p><span>Link：</span>https://www.tiege.dev/en/post/make-jwt-more-safe/</p><p><span>Author：</span>guotie</p><p><span>Declaration： </span>This blog post article is under the <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a> license,Please indicate the source!</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>If it can help you, you can give tips for blogger that how much you want. ^_^</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>Reward</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=https://www.tiege.dev/img/wechat-pay.png alt="WeChat Pay"><p>Wechat Pay</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=https://www.tiege.dev/img/ali-pay.png alt=Alipay><p>Ali Pay</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://www.tiege.dev/en/post/centrals-instructions-should-using-account-abstraction/ rel=next title="Centralized exchanges and wallets should take the lead in using Account abstraction"><i class="fa fa-chevron-left"></i> Centralized exchanges and wallets should take the lead in using Account abstraction</a></div><div class="post-nav-prev post-nav-item"><a href=https://www.tiege.dev/en/post/uniswap/uniswap-loopback-swap-fee/ rel=prev title="rate fee of loopback swap in uniswap">rate fee of loopback swap in uniswap
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=https://www.tiege.dev/img/avatar.png alt=guotie><p class=site-author-name itemprop=name>guotie</p><p class="site-description motion-element" itemprop=description>better code, better life</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=https://www.tiege.dev/en/post/><span class=site-state-item-count>4</span>
<span class=site-state-item-name>Blogs</span></a></div><div class="site-state-item site-state-categories"><a href=https://www.tiege.dev/en/categories/><span class=site-state-item-count>6</span>
<span class=site-state-item-name>Categories</span></a></div><div class="site-state-item site-state-tags"><a href=https://www.tiege.dev/en/tags/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>Tags</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/guotie/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://twitter.com/guotie target=_blank title=twitter><i class="fa fa-fw fa-twitter"></i>
twitter</a></span>
<span class=links-of-author-item><a href=https://t.me/anydefi target=_blank title=telegram><i class="fa fa-fw fa-telegram"></i>
telegram</a></span>
<span class=links-of-author-item><a href=mailto:guotie.9@gmail.com target=_blank title=email><i class="fa fa-fw fa-envelope"></i>
email</a></span>
<span class=links-of-author-item><a href=https://medium.com/@guotie target=_blank title=medium><i class="fa fa-fw fa-medium"></i>
medium</a></span></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
TagCloud</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/account-abstraction>Account abstraction</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/arbitrage>Arbitrage</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/crypto>Crypto</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/defi>Defi</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/etheruem>Etheruem</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/jwt>JWT</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/libuv>Libuv</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/linux>Linux</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/safety>Safety</a></li><li class=tagcloud-of-blogroll-item><a href=https://www.tiege.dev/en/tags/solidity>Solidity</a></li></ul></div><div class="links-of-blogroll motion-element inline"><script type=text/javascript src="//rf.revolvermaps.com/0/0/6.js?i=53tnks7nxby&amp;m=7&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async></script></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>Uncle Tony</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.119.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info></div><div class=license-info><span class=separator-line>/</span>
<span class=license-num><a href target=_blank></a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/2.1.4/jquery.min.js></script>
<script type=text/javascript src=https://www.tiege.dev/js/search.js></script>
<script type=text/javascript src=https://www.tiege.dev/js/affix.js></script>
<script type=text/javascript src=https://www.tiege.dev/js/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var e=$(".header-inner").height()+10;$("#sidebar").css({"margin-top":e}).show(),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//cdn.bootcdn.net/ajax/libs/imageviewer/0.1.0/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>$(function(){detectIE()>0?$.getScript(document.location.protocol+"//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,avatar:"wavatar",avatarCDN:"https://sdn.geekzu.org/avatar/",avatarForce:!1,wordLimit:"200",placeholder:" Just do what you want leave here, and don't forget give your email to make exchange. ^_^ ",requiredFields:["nick","mail"],serverURL:"https://waline-blog-api.vercel.app",lang:"en"})}):$("#wcomments").html("Sorry, Waline plugin doesn't support IE or Edge, Please swithc to Chrome browser.")})</script><script>(function(){var t,e=document.createElement("script"),n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>